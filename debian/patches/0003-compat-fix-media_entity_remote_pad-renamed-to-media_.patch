From: "You-Sheng Yang (vicamo)" <vicamo.yang@canonical.com>
Date: Wed, 24 Aug 2022 15:30:43 +0800
Subject: compat: fix media_entity_remote_pad renamed to
 media_pad_remote_pad_first

Signed-off-by: You-Sheng Yang (vicamo) <vicamo.yang@canonical.com>
---
 drivers/media/pci/intel/ipu-isys-csi2.c  |  4 ++++
 drivers/media/pci/intel/ipu-isys-queue.c |  4 ++++
 drivers/media/pci/intel/ipu-isys-video.c | 12 ++++++++++++
 3 files changed, 20 insertions(+)

diff --git a/drivers/media/pci/intel/ipu-isys-csi2.c b/drivers/media/pci/intel/ipu-isys-csi2.c
index dde3213..5be7800 100644
--- a/drivers/media/pci/intel/ipu-isys-csi2.c
+++ b/drivers/media/pci/intel/ipu-isys-csi2.c
@@ -304,7 +304,11 @@ static int csi2_link_validate(struct media_link *link)
 
 	if (!v4l2_ctrl_g_ctrl(csi2->store_csi2_header)) {
 		struct media_pad *remote_pad =
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(6,0,0))
 		    media_entity_remote_pad(&csi2->asd.pad[CSI2_PAD_SOURCE]);
+#else
+		    media_pad_remote_pad_first(&csi2->asd.pad[CSI2_PAD_SOURCE]);
+#endif
 
 		if (remote_pad &&
 		    is_media_entity_v4l2_subdev(remote_pad->entity)) {
diff --git a/drivers/media/pci/intel/ipu-isys-queue.c b/drivers/media/pci/intel/ipu-isys-queue.c
index c9655ce..ba2e654 100644
--- a/drivers/media/pci/intel/ipu-isys-queue.c
+++ b/drivers/media/pci/intel/ipu-isys-queue.c
@@ -652,7 +652,11 @@ int ipu_isys_link_fmt_validate(struct ipu_isys_queue *aq)
 {
 	struct ipu_isys_video *av = ipu_isys_queue_to_video(aq);
 	struct v4l2_subdev_format fmt = { 0 };
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(6,0,0))
 	struct media_pad *pad = media_entity_remote_pad(av->vdev.entity.pads);
+#else
+	struct media_pad *pad = media_pad_remote_pad_first(av->vdev.entity.pads);
+#endif
 	struct v4l2_subdev *sd;
 	int rval;
 
diff --git a/drivers/media/pci/intel/ipu-isys-video.c b/drivers/media/pci/intel/ipu-isys-video.c
index 4974fe3..b34f112 100644
--- a/drivers/media/pci/intel/ipu-isys-video.c
+++ b/drivers/media/pci/intel/ipu-isys-video.c
@@ -609,7 +609,11 @@ static int link_validate(struct media_link *link)
 		return -EINVAL;
 	sd = media_entity_to_v4l2_subdev(link->source->entity);
 	if (is_external(av, link->source->entity)) {
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(6,0,0))
 		ip->external = media_entity_remote_pad(av->vdev.entity.pads);
+#else
+		ip->external = media_pad_remote_pad_first(av->vdev.entity.pads);
+#endif
 		ip->source = to_ipu_isys_subdev(sd)->source;
 	}
 
@@ -685,7 +689,11 @@ static int get_external_facing_format(struct ipu_isys_pipeline *ip,
 	external_facing = (strncmp(sd->name, IPU_ISYS_ENTITY_PREFIX,
 			   strlen(IPU_ISYS_ENTITY_PREFIX)) == 0) ?
 			   ip->external :
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(6,0,0))
 			   media_entity_remote_pad(ip->external);
+#else
+			   media_pad_remote_pad_first(ip->external);
+#endif
 	if (WARN_ON(!external_facing)) {
 		dev_warn(&av->isys->adev->dev,
 			 "no external facing pad --- driver bug?\n");
@@ -1037,7 +1045,11 @@ static int start_stream_firmware(struct ipu_isys_video *av,
 	struct ipu_isys_video *isl_av = NULL;
 	struct v4l2_subdev_format source_fmt = { 0 };
 	struct v4l2_subdev *be_sd = NULL;
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(6,0,0))
 	struct media_pad *source_pad = media_entity_remote_pad(&av->pad);
+#else
+	struct media_pad *source_pad = media_pad_remote_pad_first(&av->pad);
+#endif
 	struct ipu_fw_isys_cropping_abi *crop;
 	enum ipu_fw_isys_send_type send_type;
 	int rval, rvalout, tout;
